name: build-linux-container
on:
  push:
    branches:
      - master

jobs:
  windows-test:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v2
      - name: Build code
        run: |
          dotnet build -c Release
      - name: Test
        run: |
          dotnet test -c Release
  ubuntu-docker-build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Build code
        run: |
          dotnet build -c Release
      - uses: docker/login-action@v2
        with:
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_TOKEN }}
      - name: Build docker image
        run: |
          docker login 
          cd ./build/docker/dotnet6-paddle
          docker build . -t sdflysha/dotnet6-paddle:2.3.0-ubuntu20
          docker push sdflysha/dotnet6-paddle:2.3.0-ubuntu20
      - uses: kohlerdominik/docker-run-action@v1
        with:
          image: sdflysha/dotnet6-paddle:2.3.0-ubuntu20
          volumes: ${{ github.workspace }}:/workspace
          run: |
            uname -a
            dotnet test -c Release